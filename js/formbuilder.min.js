(function(e){var t=e("ul#wpuf-form-editor"),n={init:function(){this.makeSortable();this.tooltip();e("#wpuf-metabox-settings").on("change",'select[name="wpuf_settings[redirect_to]"]',this.settingsRedirect);e('select[name="wpuf_settings[redirect_to]"]').change();e("#wpuf-metabox-settings").on("change",'input[type=checkbox][name="wpuf_settings[guest_post]"]',this.settingsGuest);e('input[type=checkbox][name="wpuf_settings[guest_post]"]').change();e("#wpuf-metabox-settings").on("change",'input[type=checkbox][name="wpuf_settings[guest_details]"]',this.settingsUserDetails);e('input[type=checkbox][name="wpuf_settings[guest_details]"]').change();e("button.wpuf-collapse").on("click",this.collpaseEditFields);e(".wpuf-form-buttons").on("click","button",this.addNewField);e("#wpuf-form-editor").on("click",".wpuf-remove",this.removeFormField);e("#wpuf-form-editor").on("change",'li.custom-field input[data-type="label"]',this.setMetaKey);e("#wpuf-form-editor").on("change",".wpuf-form-sub-fields input[type=text]",function(){e(this).prev("input[type=checkbox], input[type=radio]").val(e(this).val())});e("#wpuf-form-editor").on("click","input[type=checkbox].multicolumn",function(){var t=e(this),n=t.closest(".wpuf-form-rows");if(t.is(":checked")){n.next().hide().next().hide();n.siblings(".column-names").show()}else{n.next().show().next().show();n.siblings(".column-names").hide()}});e("#wpuf-form-editor").on("click",".wpuf-toggle",this.toggleFormField);e("#wpuf-form-editor").on("click","img.wpuf-clone-field",this.cloneField);e("#wpuf-form-editor").on("click","img.wpuf-remove-field",this.removeField)},makeSortable:function(){t=e("ul#wpuf-form-editor");t&&t.sortable({placeholder:"ui-state-highlight",handle:"> .wpuf-legend",distance:5,start:function(e,t){},stop:function(e,t){}})},addNewField:function(t){t.preventDefault();var r=e(this),i=e("ul#wpuf-form-editor"),s=r.data("name"),o=r.data("type"),u={name:s,type:o,order:i.find("li").length+1,action:"wpuf_form_add_el"},a=["post_title","post_content","post_excerpt","featured_image"];if(e.inArray(s,a)>=0&&i.find("li."+s).length){alert("You already have this in the form");return!1}e(".wpuf-loading").removeClass("hide");e.post(ajaxurl,u,function(t){i.append(t);n.makeSortable();n.tooltip();e(".wpuf-loading").addClass("hide")})},removeFormField:function(t){t.preventDefault();confirm("are you sure?")&&e(this).closest("li").fadeOut(function(){e(this).remove()})},toggleFormField:function(t){t.preventDefault();e(this).closest("li").find(".wpuf-form-holder").slideToggle("fast")},cloneField:function(t){t.preventDefault();var n=e(this).closest("div"),r=n.clone();r.find("input").val("");r.find(":checked").attr("checked","");n.after(r)},removeField:function(){var t=e(this).closest("div"),n=t.siblings().andSelf().length;n>1&&t.remove()},setMetaKey:function(){var t=e(this),n=t.val().toLowerCase().split(" ").join("_").split("'").join(""),r=e(this).closest(".wpuf-form-rows").next().find("input[type=text]");r.length&&r.val(n)},tooltip:function(){e(".smallipopInput").smallipop({preferredPosition:"right",theme:"black",popupOffset:0,triggerOnClick:!0})},collpaseEditFields:function(t){t.preventDefault();e("ul#wpuf-form-editor").children("li").find(".wpuf-form-holder").slideToggle()},settingsGuest:function(t){t.preventDefault();var n=e(this).closest("table");if(e(this).is(":checked")){n.find("tr.show-if-guest").show();n.find("tr.show-if-not-guest").hide();e('input[type=checkbox][name="wpuf_settings[guest_details]"]').change()}else{n.find("tr.show-if-guest").hide();n.find("tr.show-if-not-guest").show()}},settingsUserDetails:function(t){t.preventDefault();var n=e(this).closest("table");e(this).is(":checked")?n.find("tr.show-if-details").show():n.find("tr.show-if-details").hide()},settingsRedirect:function(t){t.preventDefault();var n=e(this),r=n.closest("table"),i=n.val();switch(i){case"post":r.find("tr.wpuf-page-id, tr.wpuf-url, tr.wpuf-same-page").hide();break;case"page":r.find("tr.wpuf-page-id").show();r.find("tr.wpuf-same-page").hide();r.find("tr.wpuf-url").hide();break;case"url":r.find("tr.wpuf-page-id").hide();r.find("tr.wpuf-same-page").hide();r.find("tr.wpuf-url").show();break;case"same":r.find("tr.wpuf-page-id").hide();r.find("tr.wpuf-url").hide();r.find("tr.wpuf-same-page").show()}}};e(function(){function t(){e("form[name=post]").submit(function(t){t.preventDefault();e.post(ajaxurl,e(this).serialize()+"&action=wpuf_form_dump",function(t){e("#temp-result").html(t)})})}n.init();e("button.clear-area").on("click",function(t){t.preventDefault();e("#temp-result").html(" ")})})})(jQuery);